events {
    worker_connections 1024;
}

http{

    upstream orders-backend {
        least_conn;
        keepalive 32;
        server 174.129.83.77:8081;
    }

    upstream user-backend {
        least_conn;
        keepalive 32;
        server 174.129.83.77:8082;
    }

    upstream auth-backend {
        least_conn;
        keepalive 32;
        server 54.236.195.176:8083;
    }

    upstream payment-backend {
        least_conn;
        keepalive 32;
        server 54.236.195.176:8087;
    }

    upstream stock-backend {
        least_conn;
        keepalive 32;
        server 54.84.180.144:8085;
    }

    upstream cart-backend {
        least_conn;
        keepalive 32;
        server 54.84.180.144:8086;
    }

    upstream product-backend {
        least_conn;
        keepalive 32;
        server 3.87.229.125:8084;
    }

    server{
        listen 80;
        server_name api-v8-ecommerce.tk;


        location /api/v1/orders {
            proxy_pass http://orders-backend$request_uri;
        }

        location /api/v1/users {
            proxy_pass http://user-backend$request_uri;
        }

        location /api/v1/auth {
            proxy_pass http://auth-backend$request_uri;
        }

        location /api/v1/payment {
            proxy_pass http://payment-backend$request_uri;
        }

        location /api/v1/stock {
            proxy_pass http://stock-backend$request_uri;
        }

        location /api/v1/cart {
            proxy_pass http://cart-backend$request_uri;
        }

        location /api/v1/products {
            proxy_pass http://product-backend$request_uri;
        }
    }
    
}